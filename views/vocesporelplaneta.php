<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prisma Climático - Beca Voces por el Planeta</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/mobile.css">
    <link rel="stylesheet" href="../assets/css/form.css">
    <link rel="stylesheet" href="../assets/css/api-status.css">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <nav class="nav-menu" id="navbar">
        <button class="hamburger" id="hamburger" aria-label="Abrir menú">
            <span></span><span></span><span></span>
        </button>
        <ul class="nav-links" id="navLinks">
            <li><a href="#inicio">Inicio</a></li>
            <li><a href="#sobre">Sobre el Programa</a></li>
            <li><a href="#requisitos">Requisitos</a></li>
            <li><a href="#cronograma">Cronograma</a></li>
            <li><a href="#faq">FAQ</a></li>
            <li><a href="#postular">Postular</a></li>
        </ul>
    </nav>

    <section id="inicio" class="hero">
        <div class="hero-content">
            <div class="hero-text">
                <h1> Beca Voces por el Planeta</h1>
                <div class="subtitle">ARTE - DERECHOS - CLIMA</div>
                <div class="tagline"></div>
                <p class="manifesto">
                    "Transformamos el silencio en arte y los datos en historias humanas
                    para construir un futuro justo y sostenible para Paraguay."
                </p>
                <a href="#postular" class="cta-primary">¡Postula Ahora!</a>
            </div>
            <!-- Eliminado hero-visual y hero-image-container -->
        </div>
    </section>

    <section id="sobre" class="section">
        <h2>Sobre el Programa</h2>

        <!-- Nueva sección de texto descriptivo -->
        <div class="program-description">
            <p><strong>Beca Voces por el Planeta</strong> es una respuesta estratégica a la necesidad de democratizar el
                debate
                sobre la crisis climática en Paraguay, un diálogo a menudo dominado por discursos técnicos que excluyen
                las narrativas populares y las experiencias vividas.</p>
            <p>Impulsada por <strong>ASHOEDU</strong> con el apoyo de <strong>WWF Paraguay</strong>, la iniciativa
                utiliza
                el poder transformador del arte y el activismo para amplificar las voces de colectivos históricamente
                marginados, con un foco especial en jóvenes (18-35 años), comunidades fuera del Área Metropolitana de
                Asunción y la población LGBTIQ+.</p>
            <a href="https://drive.google.com/file/d/18kDdKK9EUKhQrQnsSU2MFn2fojQG2obD/view?usp=sharing" target="_blank"
                class="cta-secondary">
                <i class="fas fa-file-alt"></i> Leer Bases y Condiciones
            </a>
        </div>

        <div class="about-grid">
            <div class="about-card">
                <h3><i class="fas fa-paint-brush"></i> Arte por el Cambio</h3>
                <p>Utilizamos el poder transformador del arte y el activismo para amplificar las voces de colectivos
                    históricamente marginados en el debate sobre la crisis climática en Paraguay.</p>
            </div>
            <div class="about-card">
                <h3><i class="fas fa-dollar-sign"></i> Financiamiento </h3>
                <p>Cada proyecto seleccionado recibirá el financiamiento para materiales, equipos, honorarios creativos
                    y acciones de difusión. 60% al firmar convenio, 40% al finalizar.</p>
            </div>
            <div class="about-card">
                <h3><i class="fas fa-hands-helping"></i> Mentoría y Acompañamiento</h3>
                <p>Brindamos acompañamiento técnico y artístico durante todo el proceso, desde la conceptualización
                    hasta la exhibición final en la Galería Climática.</p>
            </div>
            <div class="about-card">
                <h3><i class="fas fa-users"></i> Enfoque Inclusivo</h3>
                <p>Priorizamos comunidades fuera del Área Metropolitana de Asunción y la población LGBTIQ+.</p>
            </div>
        </div>
    </section>

    <section id="requisitos" class="section requirements">
        <h2>¿Quién Puede Postular?</h2>
        <div class="requirements-grid">
            <div class="requirement-item">
                <h4><i class="fas fa-calendar-alt"></i> Edad</h4>
                <p>Entre 18 y 35 años</p>
            </div>
            <div class="requirement-item">
                <h4><i class="fas fa-home"></i> Residencia</h4>
                <p>Residir en Paraguay</p>
            </div>
            <div class="requirement-item">
                <h4><i class="fas fa-user-tie"></i> Perfil</h4>
                <p>Artistas, colectivos o activistas</p>
            </div>
            <div class="requirement-item">
                <h4><i class="fas fa-leaf"></i> Enfoque</h4>
                <p>Proyecto que conecte arte y justicia climática</p>
            </div>
            <div class="requirement-item">
                <h4><i class="fas fa-file-invoice-dollar"></i> RUC</h4>
                <p>No necesario para postular (solo para seleccionados)</p>
            </div>
            <div class="requirement-item">
                <h4><i class="fas fa-eye"></i> Exposición</h4>
                <p>Obra accesible al público gratuitamente</p>
            </div>
        </div>
    </section>

    <section id="cronograma" class="section timeline">
        <h2>Cronograma</h2>
        <div class="timeline-container">
            <div class="timeline-item">
                <div class="timeline-date">01-30 AGO</div>
                <div class="timeline-content">
                    <h4>Convocatoria Abierta</h4>
                    <p>Período de postulaciones. Webinars explicativos disponibles para resolver todas tus dudas.</p>
                </div>
            </div>
            <div class="timeline-item">
                <div class="timeline-date">08-13 SEP</div>
                <div class="timeline-content">
                    <h4>Evaluación y Selección</h4>
                    <p>Proceso de adjudicación por comité evaluador paritario integrado por WWF, Prisma Climático y
                        asesora externa.</p>
                </div>
            </div>
            <div class="timeline-item">
                <div class="timeline-date">15 SEP</div>
                <div class="timeline-content">
                    <h4>Anuncio de Resultados</h4>
                    <p>Publicación de proyectos seleccionados en web oficial y redes sociales.</p>
                </div>
            </div>
            <div class="timeline-item">
                <div class="timeline-date">22 SEP - 25 OCT</div>
                <div class="timeline-content">
                    <h4>Desarrollo de Proyectos</h4>
                    <p>Ejecución de obras con acompañamiento y mentoría continua por parte del equipo técnico.</p>
                </div>
            </div>
            <div class="timeline-item">
                <div class="timeline-date">25 OCT - 08 NOV</div>
                <div class="timeline-content">
                    <h4>Galería Climática</h4>
                    <p>Evento final de exhibición y celebración del arte por la justicia climática. ¡El momento de
                        brillar!</p>
                </div>
            </div>
        </div>
    </section>

    <section id="faq" class="section faq">
        <h2>Preguntas Frecuentes</h2>
        <div class="faq-item">
            <div class="faq-question">
                ¿Necesito tener RUC para postular?
            </div>
            <div class="faq-answer">
                No. El RUC se solicitará solo a los proyectos seleccionados para firmar el convenio (puede ser tuyo o de
                una organización aliada).
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">
                ¿Qué gastos cubre la beca de USD 1,200?
            </div>
            <div class="faq-answer">
                Materiales, alquiler de equipos, honorarios creativos, transporte local y acciones de difusión. No cubre
                compra de equipos permanentes ni viajes internacionales.
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">
                ¿Mi obra debe estar lista para postular?
            </div>
            <div class="faq-answer">
                No. Aceptamos ideas en etapa de diseño; deberás ejecutarla entre el 22 de septiembre y 25 de octubre de
                2025.
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">
                ¿Cómo se realiza el pago?
            </div>
            <div class="faq-answer">
                60% al firmar el convenio y 40% al entregar el informe final y las evidencias de la obra.
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">
                ¿Puedo colaborar con artistas de otro país?
            </div>
            <div class="faq-answer">
                Sí, pero la persona o colectivo responsable debe residir en Paraguay y la obra debe exhibirse aquí.
            </div>
        </div>
    </section>

    <section id="postular" class="section form-section">
        <h2>¡Postula a la Beca Voces por el Planeta!</h2>
        
        <!-- Barra de progreso -->
        <div class="form-progress">
            <div class="progress-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Datos Personales</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Proyecto Artístico</div>
            </div>
        </div>

        <form id="formulario-voces" class="application-form" enctype="multipart/form-data" method="POST" action="../views/process_form.php">
            <!-- Paso 1: Datos Personales -->
            <div id="form-step-1" class="form-step active">
                <h3>Datos Personales</h3>
                
                <div class="form-row">
            <div class="form-group">
                        <label for="nombre">Nombre y Apellido *</label>
                        <input type="text" id="nombre" name="nombre" required maxlength="100" placeholder="Tu nombre completo">
            </div>
            <div class="form-group">
                        <label for="edad">Edad *</label>
                        <input type="number" id="edad" name="edad" min="18" max="35" required placeholder="18-35 años">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="departamento">Departamento *</label>
                        <select name="departamento" id="departamento" required>
                            <option value="">Cargando departamentos...</option>
                        </select>
            </div>
            <div class="form-group">
                        <label for="ciudad">Ciudad *</label>
                        <select name="ciudad" id="ciudad" required>
                            <option value="">Primero selecciona un departamento</option>
                        </select>
                    </div>
            </div>

                <div class="form-row">
            <div class="form-group">
                        <label for="barrio">Barrio</label>
                        <select name="barrio" id="barrio">
                            <option value="">Primero selecciona una ciudad</option>
                </select>
            </div>
            <div class="form-group">
                        <label for="direccion">Dirección específica</label>
                        <input type="text" id="direccion" name="direccion" placeholder="Calle, número, entre calles">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Correo electrónico *</label>
                        <input type="email" id="email" name="email" required placeholder="ejemplo@email.com">
            </div>
            <div class="form-group">
                        <label for="telefono">Número de celular *</label>
                        <input type="tel" id="telefono" name="telefono" required placeholder="+595 9XX XXX XXX">
                    </div>
                </div>

                <div class="form-group">
                    <label>Tipo de obra *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="tipo_obra" value="individual" required>
                            <span class="radio-custom"></span>
                            Individual
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="tipo_obra" value="colectiva" required>
                            <span class="radio-custom"></span>
                            Colectiva
                        </label>
                    </div>
                </div>

                <div class="form-group" id="integrantes-group" style="display: none;">
                    <label for="integrantes">Cantidad de integrantes *</label>
                    <input type="number" id="integrantes" name="integrantes" min="2" max="20" placeholder="Número de integrantes">
                </div>

                <div class="form-group">
                    <label for="profesion">Profesión *</label>
                    <select name="profesion" id="profesion" required>
                        <option value="">Selecciona tu profesión</option>
                        <option value="artista">Artista</option>
                        <option value="comunicador">Comunicador/a</option>
                        <option value="gestor_cultural">Gestor cultural</option>
                        <option value="profesional_independiente">Profesional Independiente</option>
                        <option value="activista_ambiental">Activista ambiental</option>
                        <option value="aficionado_arte">Aficionado al arte</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="portfolio">Link red social o portfolio</label>
                    <input type="url" id="portfolio" name="portfolio" placeholder="https://tuportfolio.com">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-next" onclick="nextStep()">Siguiente <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <!-- Paso 2: Proyecto Artístico -->
            <div id="form-step-2" class="form-step">
                <h3>Proyecto Artístico</h3>

                <div class="form-group">
                    <label for="categoria">Categoría Artística *</label>
                    <select name="categoria" id="categoria" required>
                        <option value="">Selecciona una categoría</option>
                        <option value="A1">Escénicas & Música</option>
                        <option value="A2">Intervenciones Urbanas</option>
                        <option value="A3">Visual & Audiovisual</option>
                        <option value="A4">Sonoras & Radiales</option>
                        <option value="A5">Gráfica & Editorial</option>
                        <option value="A6">Digital & Viral</option>
                        <option value="A7">Diálogo & Pensamiento Crítico</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="titulo_obra">Título de la obra *</label>
                    <input type="text" id="titulo_obra" name="titulo_obra" maxlength="100" required placeholder="Título creativo de tu obra">
                    <div class="char-counter"><span id="titulo-counter">0</span>/100</div>
                </div>

                <div class="form-group">
                    <label for="tecnica">¿Qué técnica piensas usar para tu obra? *</label>
                    <textarea id="tecnica" name="tecnica" maxlength="300" rows="3" required placeholder="Describe la técnica que utilizarás"></textarea>
                    <div class="char-counter"><span id="tecnica-counter">0</span>/300</div>
                </div>

                <div class="form-group">
                    <label for="inspiracion">¿Cuál fue tu inspiración? *</label>
                    <textarea id="inspiracion" name="inspiracion" maxlength="500" rows="4" required placeholder="Cuéntanos qué te inspiró para crear esta obra"></textarea>
                    <div class="char-counter"><span id="inspiracion-counter">0</span>/500</div>
                </div>

                <div class="form-group">
                    <label for="mensaje">¿Cuál es el mensaje que deseas transmitir? *</label>
                    <textarea id="mensaje" name="mensaje" maxlength="300" rows="3" required placeholder="El mensaje principal de tu obra"></textarea>
                    <div class="char-counter"><span id="mensaje-counter">0</span>/300</div>
                </div>

                <div class="form-group">
                    <label for="archivo">Adjuntar foto o video (JPG/PNG/MP4/MOV, máx. 50MB)</label>
                    <input type="file" id="archivo" name="archivo" accept=".jpg,.jpeg,.png,.mp4,.mov">
                    <small>Formatos permitidos: JPG, PNG, MP4, MOV. Tamaño máximo: 50MB</small>
                </div>

                <div class="form-group">
                    <label>¿Tu obra está diseñada para ser transportada? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="transportable" value="si" required>
                            <span class="radio-custom"></span>
                            Sí
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="transportable" value="no" required>
                            <span class="radio-custom"></span>
                            No
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="como_enteraste">¿Cómo te enteraste del concurso? *</label>
                    <select name="como_enteraste" id="como_enteraste" required>
                        <option value="">Selecciona una opción</option>
                        <option value="redes_sociales">Redes sociales</option>
                        <option value="television">Televisión</option>
                        <option value="email">Email</option>
                        <option value="radio">Radio</option>
                        <option value="charlas">Charlas</option>
                        <option value="otros">Otros</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="accion_climatica">¿Qué cambio o acción climática concreta esperas provocar? *</label>
                    <textarea id="accion_climatica" name="accion_climatica" maxlength="500" rows="3" required placeholder="Describe el impacto climático que esperas generar"></textarea>
                    <div class="char-counter"><span id="accion-counter">0</span>/500</div>
                </div>

                <div class="form-group">
                    <label for="conexion_comunidad">¿Cómo tu obra conecta con la comunidad y promueve la sostenibilidad? *</label>
                    <textarea id="conexion_comunidad" name="conexion_comunidad" maxlength="500" rows="3" required placeholder="Explica la conexión con la comunidad"></textarea>
                    <div class="char-counter"><span id="comunidad-counter">0</span>/500</div>
                </div>

                <div class="form-group">
                    <label for="sostenibilidad">¿Cómo tu obra contribuye a la sostenibilidad ambiental? *</label>
                    <textarea id="sostenibilidad" name="sostenibilidad" maxlength="500" rows="3" required placeholder="Describe la contribución a la sostenibilidad"></textarea>
                    <div class="char-counter"><span id="sostenibilidad-counter">0</span>/500</div>
                </div>

            <div class="form-group">
                    <label class="checkbox-option">
                        <input type="checkbox" name="acepta_bases" value="si" required>
                        <span class="checkbox-custom"></span>
                        Acepto todas las bases y condiciones del concurso *
                    </label>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-prev" onclick="prevStep()"><i class="fas fa-arrow-left"></i> Anterior</button>
                    <button type="submit" class="btn-submit">Enviar Postulación <i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </form>

        <!-- Mensaje de éxito (se mostrará después del envío) -->
        <div id="mensaje-exito" style="display:none;">
            <h3>¡Gracias por sumar tu voz al planeta!</h3>
            <p>Revisaremos todas las propuestas entre el 1 y 6 de septiembre de 2025.<br>
                Publicaremos la lista de proyectos seleccionados el 15 de septiembre en las redes de WWF Paraguay y ASOEDHU
                y en www.asoedhu.org/vocesxelplaneta.<br>
                Mientras tanto, podés consultar las Preguntas Frecuentes.<br>
                Si surge alguna duda adicional, escríbenos al email info@asoedhu.org.<br>
                ¡Éxitos y gracias por crear arte en defensa del clima!</p>
        </div>
    </section>

    <footer class="footer">
        <div class="logos">
            <div class="logo-placeholder">WWF Paraguay</div>
            <div class="logo-placeholder">Voces por el Planeta</div>
            <div class="logo-placeholder">ASOEDHU</div>
        </div>
        <p class="footer-text">&copy; 2024 ASOEDHU. Todos los derechos reservados.</p>
    </footer>

    <a href="#postular" class="floating-btn" aria-label="Postular ahora">
        <i class="fas fa-paper-plane"></i>
    </a>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="../assets/js/script.js"></script>
    <script src="../assets/js/mobile.js"></script>
    <script src="../assets/js/form.js"></script>
    
    <script>
        // Funciones para el formulario multi-paso
        let currentStep = 1;
        const totalSteps = 2;

        function nextStep() {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    document.getElementById(`form-step-${currentStep}`).classList.remove('active');
                    currentStep++;
                    document.getElementById(`form-step-${currentStep}`).classList.add('active');
                    updateProgress();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById(`form-step-${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`form-step-${currentStep}`).classList.add('active');
                updateProgress();
            }
        }

        function updateProgress() {
            // Actualizar barra de progreso
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                if (index + 1 <= currentStep) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }

        function validateStep(step) {
            const currentStepElement = document.getElementById(`form-step-${step}`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });

            // Validaciones específicas
            if (step === 1) {
                const edad = document.getElementById('edad').value;
                if (edad && (edad < 18 || edad > 35)) {
                    document.getElementById('edad').classList.add('error');
                    alert('La edad debe estar entre 18 y 35 años');
                    isValid = false;
                }

                const email = document.getElementById('email').value;
                if (email && !isValidEmail(email)) {
                    document.getElementById('email').classList.add('error');
                    alert('Por favor ingresa un email válido');
                    isValid = false;
                }
            }

            return isValid;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Contadores de caracteres
        function updateCharCounter(inputId, counterId, maxLength) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            
            if (input && counter) {
                const currentLength = input.value.length;
                counter.textContent = currentLength;
                
                if (currentLength > maxLength * 0.8) {
                    counter.style.color = '#ff6b6b';
                } else {
                    counter.style.color = '#666';
                }
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Contadores de caracteres
            const textAreas = ['titulo_obra', 'tecnica', 'inspiracion', 'mensaje', 'accion_climatica', 'conexion_comunidad', 'sostenibilidad'];
            const maxLengths = [100, 300, 500, 300, 500, 500, 500];

            textAreas.forEach((id, index) => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function() {
                        updateCharCounter(id, `${id}-counter`, maxLengths[index]);
                    });
                }
            });

            // Toggle integrantes
            const tipoObraRadios = document.querySelectorAll('input[name="tipo_obra"]');
            const integrantesGroup = document.getElementById('integrantes-group');
            const integrantesInput = document.getElementById('integrantes');

            tipoObraRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'colectiva') {
                        integrantesGroup.style.display = 'block';
                        integrantesInput.required = true;
                    } else {
                        integrantesGroup.style.display = 'none';
                        integrantesInput.required = false;
                        integrantesInput.value = '';
                    }
                });
            });

            // Cargar departamentos desde la API al iniciar
            loadDepartamentos();

            // Actualizar ciudades según departamento
            const departamentoSelect = document.getElementById('departamento');
            const ciudadSelect = document.getElementById('ciudad');
            const barrioSelect = document.getElementById('barrio');

            if (departamentoSelect && ciudadSelect) {
                departamentoSelect.addEventListener('change', function() {
                    updateCiudades(this.value);
                });
            }

            if (ciudadSelect && barrioSelect) {
                ciudadSelect.addEventListener('change', function() {
                    updateBarrios(this.value);
                });
            }

            // Validación de archivo
            const archivoInput = document.getElementById('archivo');
            if (archivoInput) {
                archivoInput.addEventListener('change', function() {
                    validateFile(this);
                });
            }
        });

        // Función para actualizar ciudades usando la API de delpi.dev
        async function updateCiudades(departamento) {
            const ciudadSelect = document.getElementById('ciudad');
            const barrioSelect = document.getElementById('barrio');
            
            if (!ciudadSelect) return;
            
            // Limpiar ciudades y barrios
            ciudadSelect.innerHTML = '<option value="">Cargando ciudades...</option>';
            if (barrioSelect) {
                barrioSelect.innerHTML = '<option value="">Primero selecciona una ciudad</option>';
            }
            
            try {
                // Verificar si la API está disponible antes de intentar obtener datos
                const endpoint = `https://api.delpi.dev/api/ciudades?departamento=${departamento}`;
                const endpointDisponible = await verificarEndpoint(endpoint, 3000);
                
                let ciudades = [];
                
                if (endpointDisponible) {
                    // Obtener ciudades desde la API de delpi.dev con timeout
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch(endpoint, {
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    clearTimeout(timeoutId);
                    
                    // Verificar si la respuesta contiene HTML en lugar de JSON
                    const contentType = response.headers.get("content-type");
                    const esRespuestaHTML = contentType && contentType.includes("text/html");
                    
                    if (esRespuestaHTML) {
                        console.warn('La API devolvió HTML en lugar de JSON');
                        // Usar datos locales si están disponibles (para ciudades podríamos no tenerlos)
                        if (window.ciudadesData && window.ciudadesData[departamento]) {
                            ciudades = window.ciudadesData[departamento];
                        }
                    } else {
                        const textoRespuesta = await response.text();
                        
                        // Verificar si el texto comienza con '<!doctype' o '<html', lo que indica HTML
                        if (textoRespuesta.trim().toLowerCase().startsWith('<!doctype') || 
                            textoRespuesta.trim().toLowerCase().startsWith('<html')) {
                            console.warn('La API devolvió HTML en lugar de JSON');
                            // Usar datos locales si están disponibles
                            if (window.ciudadesData && window.ciudadesData[departamento]) {
                                ciudades = window.ciudadesData[departamento];
                            }
                        } else {
                            // Intentar parsear el JSON
                            const json = JSON.parse(textoRespuesta);
                            ciudades = (json.root && json.root.length > 0) ? json.root : [];
                        }
                    }
                } else {
                    console.warn('API endpoint de ciudades no disponible');
                    // Usar datos locales si están disponibles
                    if (window.ciudadesData && window.ciudadesData[departamento]) {
                        ciudades = window.ciudadesData[departamento];
                    }
                }
                
                // Limpiar y llenar el dropdown de ciudades
                ciudadSelect.innerHTML = '<option value="">Selecciona una ciudad</option>';
                
                if (ciudades && ciudades.length > 0) {
                    ciudades.forEach(ciudad => {
                        const option = document.createElement('option');
                        option.value = ciudad.id || ciudad.nombre;
                        option.textContent = ciudad.nombre;
                        ciudadSelect.appendChild(option);
                    });
                } else {
                    ciudadSelect.innerHTML = '<option value="">No se encontraron ciudades</option>';
                }
                
            } catch (error) {
                console.error('Error cargando ciudades:', error);
                ciudadSelect.innerHTML = '<option value="">Error cargando ciudades</option>';
                
                // Intentar usar datos locales en caso de error
                if (window.ciudadesData && window.ciudadesData[departamento]) {
                    try {
                        const ciudadesLocales = window.ciudadesData[departamento];
                        if (ciudadesLocales && ciudadesLocales.length > 0) {
                            ciudadSelect.innerHTML = '<option value="">Selecciona una ciudad</option>';
                            ciudadesLocales.forEach(ciudad => {
                                const option = document.createElement('option');
                                option.value = ciudad.id || ciudad.nombre;
                                option.textContent = ciudad.nombre;
                                ciudadSelect.appendChild(option);
                            });
                        }
                    } catch (fallbackError) {
                        console.error('Error usando datos locales de ciudades:', fallbackError);
                    }
                }
            }
        }
        
        // Función para actualizar barrios usando la API de delpi.dev
        async function updateBarrios(ciudad) {
            const barrioSelect = document.getElementById('barrio');
            
            if (!barrioSelect) return;
            
            // Limpiar barrios
            barrioSelect.innerHTML = '<option value="">Cargando barrios...</option>';
            
            try {
                // Verificar si la API está disponible antes de intentar obtener datos
                const endpoint = `https://api.delpi.dev/api/barrios?ciudad=${ciudad}`;
                const endpointDisponible = await verificarEndpoint(endpoint, 3000);
                
                let barrios = [];
                
                if (endpointDisponible) {
                    // Obtener barrios desde la API de delpi.dev con timeout
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch(endpoint, {
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    clearTimeout(timeoutId);
                    
                    // Verificar si la respuesta contiene HTML en lugar de JSON
                    const contentType = response.headers.get("content-type");
                    const esRespuestaHTML = contentType && contentType.includes("text/html");
                    
                    if (esRespuestaHTML) {
                        console.warn('La API de barrios devolvió HTML en lugar de JSON');
                        // Usar datos locales si están disponibles (para barrios podríamos no tenerlos)
                        if (window.barriosData && window.barriosData[ciudad]) {
                            barrios = window.barriosData[ciudad];
                        }
                    } else {
                        const textoRespuesta = await response.text();
                        
                        // Verificar si el texto comienza con '<!doctype' o '<html', lo que indica HTML
                        if (textoRespuesta.trim().toLowerCase().startsWith('<!doctype') || 
                            textoRespuesta.trim().toLowerCase().startsWith('<html')) {
                            console.warn('La API de barrios devolvió HTML en lugar de JSON');
                            // Usar datos locales si están disponibles
                            if (window.barriosData && window.barriosData[ciudad]) {
                                barrios = window.barriosData[ciudad];
                            }
                        } else {
                            // Intentar parsear el JSON
                            const json = JSON.parse(textoRespuesta);
                            barrios = (json.root && Array.isArray(json.root)) ? json.root : (json.root && json.root.data ? json.root.data : []);
                        }
                    }
                } else {
                    console.warn('API endpoint de barrios no disponible');
                    // Usar datos locales si están disponibles
                    if (window.barriosData && window.barriosData[ciudad]) {
                        barrios = window.barriosData[ciudad];
                    }
                }
                
                // Limpiar y llenar el dropdown de barrios
                barrioSelect.innerHTML = '<option value="">Selecciona un barrio</option>';
                
                if (barrios && barrios.length > 0) {
                    barrios.forEach(barrio => {
                        const option = document.createElement('option');
                        option.value = barrio.id || barrio.nombre;
                        option.textContent = barrio.nombre;
                        barrioSelect.appendChild(option);
                    });
                } else {
                    barrioSelect.innerHTML = '<option value="">No se encontraron barrios</option>';
                }
                
            } catch (error) {
                console.error('Error cargando barrios:', error);
                barrioSelect.innerHTML = '<option value="">Error cargando barrios</option>';
                
                // Intentar usar datos locales en caso de error
                if (window.barriosData && window.barriosData[ciudad]) {
                    try {
                        const barriosLocales = window.barriosData[ciudad];
                        if (barriosLocales && barriosLocales.length > 0) {
                            barrioSelect.innerHTML = '<option value="">Selecciona un barrio</option>';
                            barriosLocales.forEach(barrio => {
                                const option = document.createElement('option');
                                option.value = barrio.id || barrio.nombre;
                                option.textContent = barrio.nombre;
                                barrioSelect.appendChild(option);
                            });
                        }
                    } catch (fallbackError) {
                        console.error('Error usando datos locales de barrios:', fallbackError);
                    }
                }
            }
        }

        // Función para cargar departamentos desde la API de delpi.dev
        async function loadDepartamentos() {
            const departamentoSelect = document.getElementById('departamento');
            
            if (!departamentoSelect) return;
            
            try {
                // Verificar si la API está disponible antes de intentar obtener datos
                const endpointDisponible = await verificarEndpoint('https://api.delpi.dev/api/departamentos', 3000);
                
                let departamentos;
                
                if (endpointDisponible) {
                    // Obtener departamentos desde la API de delpi.dev con timeout
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);
                    
                    const response = await fetch('https://api.delpi.dev/api/departamentos', {
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    clearTimeout(timeoutId);
                    
                    // Verificar si la respuesta contiene HTML en lugar de JSON
                    const contentType = response.headers.get("content-type");
                    const esRespuestaHTML = contentType && contentType.includes("text/html");
                    
                    if (esRespuestaHTML) {
                        console.warn('La API devolvió HTML en lugar de JSON, usando datos locales');
                        // Usar datos locales si la respuesta es HTML
                        departamentos = window.departamentosData || [];
                    } else {
                        const textoRespuesta = await response.text();
                        
                        // Verificar si el texto comienza con '<!doctype' o '<html', lo que indica HTML
                        if (textoRespuesta.trim().toLowerCase().startsWith('<!doctype') || 
                            textoRespuesta.trim().toLowerCase().startsWith('<html')) {
                            console.warn('La API devolvió HTML en lugar de JSON, usando datos locales');
                            departamentos = window.departamentosData || [];
                        } else {
                            // Intentar parsear el JSON
                            const json = JSON.parse(textoRespuesta);
                            departamentos = (json.root && json.root.data) ? json.root.data : [];
                        }
                    }
                } else {
                    // Si el endpoint no está disponible, usar datos locales
                    console.warn('API endpoint no disponible, usando datos locales');
                    departamentos = window.departamentosData || [];
                }
                
                // Limpiar y llenar el dropdown de departamentos
                departamentoSelect.innerHTML = '<option value="">Selecciona un departamento</option>';
                
                if (departamentos && departamentos.length > 0) {
                    departamentos.forEach(departamento => {
                        const option = document.createElement('option');
                        option.value = departamento.id || departamento.nombre;
                        option.textContent = departamento.nombre;
                        departamentoSelect.appendChild(option);
                    });
                } else {
                    // Si no hay datos, mostrar mensaje
                    departamentoSelect.innerHTML = '<option value="">No se encontraron departamentos</option>';
                }
                
            } catch (error) {
                console.error('Error cargando departamentos:', error);
                // Usar datos locales en caso de error
                try {
                    departamentoSelect.innerHTML = '<option value="">Selecciona un departamento</option>';
                    if (window.departamentosData && window.departamentosData.length > 0) {
                        window.departamentosData.forEach(departamento => {
                            const option = document.createElement('option');
                            option.value = departamento.id || departamento.nombre;
                            option.textContent = departamento.nombre;
                            departamentoSelect.appendChild(option);
                        });
                    } else {
                        departamentoSelect.innerHTML = '<option value="">Error cargando departamentos</option>';
                    }
                } catch (fallbackError) {
                    console.error('Error usando datos locales:', fallbackError);
                    departamentoSelect.innerHTML = '<option value="">Error cargando departamentos</option>';
                }
            }
        }

        // Función para validar archivo
        function validateFile(input) {
            const file = input.files[0];
            if (file) {
                const maxSize = 50 * 1024 * 1024; // 50MB
                const allowedTypes = ['image/jpeg', 'image/png', 'video/mp4', 'video/quicktime'];

                if (file.size > maxSize) {
                    alert('El archivo es demasiado grande. El tamaño máximo es 50MB.');
                    input.value = '';
                    return false;
                }

                if (!allowedTypes.includes(file.type)) {
                    alert('Tipo de archivo no permitido. Solo se permiten JPG, PNG, MP4 y MOV.');
                    input.value = '';
                    return false;
                }
            }
            return true;
        }
    </script>
    
    <!-- Cargar los datos locales y funciones de ayuda -->
    <script src="../assets/js/departamentos.js"></script>
    <script src="../assets/js/api-helpers.js"></script>
    
    <!-- Agregar elemento para diagnóstico de API -->
    <div id="api-status" class="api-status">
        <p class="api-status-message">Verificando conexión con API...</p>
        <div class="api-status-indicator"></div>
    </div>
    
    <script>
        // Inicializar la verificación de API
        document.addEventListener('DOMContentLoaded', async () => {
            const apiStatus = document.getElementById('api-status');
            const apiStatusMessage = apiStatus.querySelector('.api-status-message');
            const apiStatusIndicator = apiStatus.querySelector('.api-status-indicator');
            
            // Verificar API y actualizar indicador
            try {
                apiStatus.classList.add('visible');
                const apiDisponible = await verificarEndpoint('https://api.delpi.dev/api/departamentos', 3000);
                
                if (apiDisponible) {
                    apiStatusMessage.textContent = 'API conectada correctamente';
                    apiStatusIndicator.classList.add('success');
                } else {
                    apiStatusMessage.textContent = 'API no disponible - usando datos locales';
                    apiStatusIndicator.classList.add('error');
                }
                
                // Ocultar después de 5 segundos si todo está bien
                if (apiDisponible) {
                    setTimeout(() => {
                        apiStatus.classList.remove('visible');
                    }, 5000);
                } else {
                    // Mantener visible por más tiempo si hay un problema
                    setTimeout(() => {
                        apiStatus.classList.remove('visible');
                    }, 10000);
                }
            } catch (error) {
                apiStatusMessage.textContent = 'Error de conexión - usando datos locales';
                apiStatusIndicator.classList.add('error');
                
                // Mantener visible por más tiempo si hay un error
                setTimeout(() => {
                    apiStatus.classList.remove('visible');
                }, 10000);
            }
        });
        
        // Función para mostrar diagnóstico detallado cuando hay un error
        window.addEventListener('error', function(event) {
            // Solo activar para errores relacionados con la API
            if (event.error && event.error.message && 
                (event.error.message.includes('JSON') || 
                 event.error.message.includes('Unexpected token') ||
                 event.error.message.includes('delpi.dev'))) {
                
                // Mostrar diagnóstico en el indicador de estado
                const apiStatus = document.getElementById('api-status');
                apiStatus.classList.add('visible');
                
                // Realizar diagnóstico detallado
                diagnosticarAPI('api-status', 'https://api.delpi.dev/api/departamentos');
                
                // No ocultar automáticamente para que el usuario pueda ver el diagnóstico
            }
        });
    </script>
</body>

</html>